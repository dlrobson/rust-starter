services:
  devcontainer:
    container_name: ${PROJECT_NAME:?}-${USER:?}
    build:
      context: ..
      dockerfile: build.Dockerfile
      target: dev
      args:
        USERNAME: ${USER:?}
        UID: ${UID:?}
        GID: ${GID:?}
    user: ${USER:?}
    volumes:
      - ..:/workspaces/${PROJECT_NAME:?}:cached
      - cargo-registry:/usr/local/cargo/registry
    command: "bash -c 'trap exit TERM; sleep infinity & wait;'"

volumes:
  cargo-registry:
